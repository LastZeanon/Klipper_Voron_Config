[gcode_macro CALIBRATE_Z_ENDSTOP]
gcode:
    Z_ENDSTOP_CALIBRATE {% for p in params
                %}{'%s=%s ' % (p, params[p])}{%
               endfor %}

[gcode_macro Z_ENDSTOP_CALIBRATE]
rename_existing: Z_ENDSTOP_CALIBRATE_BASE
gcode:
    LOCK_DOCKING
    
    ATTACH_PROBE RETURN_TO_POSITION=FALSE

    G1 X150 Y150 F5000

    Z_ENDSTOP_CALIBRATE_BASE {% for p in params
                %}{'%s=%s ' % (p, params[p])}{%
               endfor %}

    RESPOND MSG="Moving the bed 20mm down"
    M117 Moving the bed 20mm down
    TESTZ Z=20
    
    UNLOCK_DOCKING
    RESPOND MSG="Please remove the probe manually and set it into the dock"
    M117 Please remove the probe manually and set it into the dock
